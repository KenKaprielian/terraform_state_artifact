name: Terraform State Artifact
on: [push]

jobs:
  terraform_in_one_step:
    runs-on: ubuntu-latest
    name: Using terraform_state_artifact action
    steps:
      - id: terraform_plan
        uses: sturlabragason/terraform_state_artifact@v1
        with:
          encryptionkey: ${{ secrets.pat }}
        env:
          TF_VAR_run_id: ${{ github.run_id }}
  terraform_two_steps:
    runs-on: ubuntu-latest
    name: Using terraform_state_artifact action in seperate steps with parameters
    steps:
      - id: terraform_plan
        uses: sturlabragason/terraform_state_artifact@v1
        with:
          encryptionkey: ${{ secrets.pat }}
          plan: true
          apply: false
        env:
          TF_VAR_run_id: ${{ github.run_id }}
      - id: terraform_apply
        uses: sturlabragason/terraform_state_artifact@v1
        with:
          encryptionkey: ${{ secrets.pat }}
          plan: false
          apply: true
        env:
          TF_VAR_run_id: ${{ github.run_id }}